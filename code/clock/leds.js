var Bodies = Matter.Bodies;

var pattern = [
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   0 - 00
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   1 - 01
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   2 - 02
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   3 - 03
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   4 - 04
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   5 - 05
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   6 - 06
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   7 - 07
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   8 - 08
                                        0x00, 0x00, 0x00, 0x00, 0x00, //   9 - 09
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  10 - 0A
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  11 - 0B
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  12 - 0C
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  13 - 0D
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  14 - 0E
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  15 - 0F
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  16 - 10
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  17 - 11
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  18 - 12
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  19 - 13
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  20 - 14
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  21 - 15
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  22 - 16
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  23 - 17
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  24 - 18
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  25 - 19
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  26 - 1A
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  27 - 1B
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  28 - 1C
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  29 - 1D
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  30 - 1E
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  31 - 1F
                                        0x00, 0x00, 0x00, 0x00, 0x00, //  32 - 20
                                        0x00, 0x00, 0x2F, 0x00, 0x00, //  33 - 21 !
                                        0x00, 0x07, 0x00, 0x07, 0x00, //  34 - 22 "
                                        0x14, 0x7F, 0x14, 0x7F, 0x14, //  35 - 23 #
                                        0x24, 0x2A, 0x7F, 0x2A, 0x12, //  36 - 24 $
                                        0x23, 0x13, 0x08, 0x64, 0x62, //  37 - 25 %
                                        0x36, 0x49, 0x55, 0x22, 0x50, //  38 - 26 &
                                        0x00, 0x05, 0x03, 0x00, 0x00, //  39 - 27 '
                                        0x00, 0x1C, 0x22, 0x41, 0x00, //  40 - 28 (
                                        0x00, 0x41, 0x22, 0x1C, 0x00, //  41 - 29 )
                                        0x14, 0x08, 0x3E, 0x08, 0x14, //  42 - 2A *
                                        0x08, 0x08, 0x3e, 0x08, 0x08, //  43 - 2B +
                                        0x00, 0x50, 0x30, 0x00, 0x00, //  44 - 2C ,
                                        0x08, 0x08, 0x08, 0x08, 0x08, //  45 - 2D -
                                        0x00, 0x60, 0x60, 0x00, 0x00, //  46 - 2E .
                                        0x20, 0x10, 0x08, 0x04, 0x02, //  47 - 2F /
                                        0x3E, 0x51, 0x49, 0x45, 0x3E, //  48 - 30 0
                                        0x00, 0x42, 0x7F, 0x40, 0x00, //  49 - 31 1
                                        0x42, 0x61, 0x51, 0x49, 0x46, //  50 - 32 2
                                        0x21, 0x41, 0x45, 0x4B, 0x31, //  51 - 33 3
                                        0x18, 0x14, 0x12, 0x7F, 0x10, //  52 - 34 4
                                        0x27, 0x45, 0x45, 0x45, 0x39, //  53 - 35 5
                                        0x3C, 0x4A, 0x49, 0x49, 0x30, //  54 - 36 6
                                        0x01, 0x71, 0x09, 0x05, 0x03, //  55 - 37 7
                                        0x36, 0x49, 0x49, 0x49, 0x36, //  56 - 38 8
                                        0x06, 0x49, 0x49, 0x29, 0x1E, //  57 - 39 9
                                        0x00, 0x36, 0x36, 0x00, 0x00, //  58 - 3A :
                                        0x00, 0x56, 0x36, 0x00, 0x00, //  59 - 3B ;
                                        0x08, 0x14, 0x22, 0x41, 0x00, //  60 - 3C <
                                        0x14, 0x14, 0x14, 0x14, 0x14, //  61 - 3D =
                                        0x00, 0x41, 0x22, 0x14, 0x08, //  62 - 3E >
                                        0x02, 0x01, 0x51, 0x09, 0x06, //  63 - 3F ?
                                        0x32, 0x49, 0x79, 0x41, 0x3E, //  64 - 40 @
                                        0x7E, 0x11, 0x11, 0x11, 0x7E, //  65 - 41 A
                                        0x7F, 0x49, 0x49, 0x49, 0x36, //  66 - 42 B
                                        0x3E, 0x41, 0x41, 0x41, 0x22, //  67 - 43 C
                                        0x7F, 0x41, 0x41, 0x22, 0x1C, //  68 - 44 D
                                        0x7F, 0x49, 0x49, 0x49, 0x41, //  69 - 45 E
                                        0x7F, 0x09, 0x09, 0x09, 0x01, //  70 - 46 F
                                        0x3E, 0x41, 0x49, 0x49, 0x7A, //  71 - 47 G
                                        0x7F, 0x08, 0x08, 0x08, 0x7F, //  72 - 48 H
                                        0x00, 0x41, 0x7F, 0x41, 0x00, //  73 - 49 I
                                        0x20, 0x40, 0x41, 0x3F, 0x01, //  74 - 4A J
                                        0x7F, 0x08, 0x14, 0x22, 0x41, //  75 - 4B K
                                        0x7F, 0x40, 0x40, 0x40, 0x40, //  76 - 4C L
                                        0x7F, 0x02, 0x0C, 0x02, 0x7F, //  77 - 4D M
                                        0x7F, 0x04, 0x08, 0x10, 0x7F, //  78 - 4E N
                                        0x3E, 0x41, 0x41, 0x41, 0x3E, //  79 - 4F O
                                        0x7F, 0x09, 0x09, 0x09, 0x06, //  80 - 50 P
                                        0x3E, 0x41, 0x51, 0x21, 0x5E, //  81 - 51 Q
                                        0x7F, 0x09, 0x19, 0x29, 0x46, //  82 - 52 R
                                        0x46, 0x49, 0x49, 0x49, 0x31, //  83 - 53 S
                                        0x01, 0x01, 0x7F, 0x01, 0x01, //  84 - 54 T
                                        0x3F, 0x40, 0x40, 0x40, 0x3F, //  85 - 55 U
                                        0x1F, 0x20, 0x40, 0x20, 0x1F, //  86 - 56 V
                                        0x3F, 0x40, 0x38, 0x40, 0x3F, //  87 - 57 W
                                        0x63, 0x14, 0x08, 0x14, 0x63, //  88 - 58 X
                                        0x07, 0x08, 0x70, 0x08, 0x07, //  89 - 59 Y
                                        0x61, 0x51, 0x49, 0x45, 0x43, //  90 - 5A Z
                                        0x00, 0x7F, 0x41, 0x41, 0x00, //  91 - 5B [
                                        0x02, 0x04, 0x08, 0x10, 0x20, //  92 - 5C BACKSLASH
                                        0x00, 0x41, 0x41, 0x7F, 0x00, //  93 - 5D ]
                                        0x04, 0x02, 0x01, 0x02, 0x04, //  94 - 5E ^
                                        0x40, 0x40, 0x40, 0x40, 0x40, //  95 - 5F _
                                        0x00, 0x01, 0x02, 0x04, 0x00, //  96 - 60 `
                                        0x20, 0x54, 0x54, 0x54, 0x78, //  97 - 61 a
                                        0x7F, 0x48, 0x44, 0x44, 0x38, //  98 - 62 b
                                        0x38, 0x44, 0x44, 0x44, 0x20, //  99 - 63 c
                                        0x38, 0x44, 0x44, 0x48, 0x3F, // 100 - 64 d
                                        0x38, 0x54, 0x54, 0x54, 0x18, // 101 - 65 e
                                        0x08, 0x7E, 0x09, 0x01, 0x02, // 102 - 66 f
                                        0x0C, 0x52, 0x52, 0x52, 0x3E, // 103 - 67 g
                                        0x7F, 0x08, 0x04, 0x04, 0x78, // 104 - 68 h
                                        0x00, 0x44, 0x7D, 0x40, 0x00, // 105 - 69 i
                                        0x20, 0x40, 0x44, 0x3D, 0x00, // 106 - 6A j
                                        0x7F, 0x10, 0x28, 0x44, 0x00, // 107 - 6B k
                                        0x00, 0x41, 0x7F, 0x40, 0x00, // 108 - 6C l
                                        0x7C, 0x04, 0x18, 0x04, 0x78, // 109 - 6D m
                                        0x7C, 0x08, 0x04, 0x04, 0x78, // 110 - 6E n
                                        0x38, 0x44, 0x44, 0x44, 0x38, // 111 - 6F o
                                        0x7C, 0x14, 0x14, 0x14, 0x08, // 112 - 70 p
                                        0x08, 0x14, 0x14, 0x78, 0x40, // 113 - 71 q
                                        0x7C, 0x08, 0x04, 0x04, 0x08, // 114 - 72 r
                                        0x48, 0x54, 0x54, 0x54, 0x20, // 115 - 73 s
                                        0x04, 0x3F, 0x44, 0x40, 0x20, // 116 - 74 t
                                        0x3C, 0x40, 0x40, 0x20, 0x7C, // 117 - 75 u
                                        0x1C, 0x20, 0x40, 0x20, 0x1C, // 118 - 76 v
                                        0x3C, 0x40, 0x30, 0x40, 0x3C, // 119 - 77 w
                                        0x44, 0x28, 0x10, 0x28, 0x44, // 120 - 78 x
                                        0x0C, 0x50, 0x50, 0x50, 0x3C, // 121 - 79 y
                                        0x44, 0x64, 0x54, 0x4C, 0x44, // 122 - 7A z
                                        0x00, 0x08, 0x36, 0x41, 0x00, // 123 - 7B {
                                        0x00, 0x00, 0x7F, 0x00, 0x00, // 124 - 7C |
                                        0x00, 0x41, 0x36, 0x08, 0x00, // 125 - 7D }
                                        0x04, 0x02, 0x04, 0x08, 0x04, // 126 - 7E ~
                                        0x55, 0x2A, 0x55, 0x2A, 0x55, // 127 - 7F CHECKER
]

var CHAR_W = 2.2;
var STR_W = CHAR_W * 5 + 1;


function createChar(c, x, y, sz, color) {
	var ret = [];
	var step = parseInt(sz * CHAR_W);
	for(let i = 0; i < 5; ++i) {
		k = pattern[c*5+i];
		for(let j = 0; j < 7; ++j) {
			if(k & 1 == 1) {
				ret.push(createCircle(x + step * i, y + step * j, sz, color));
			}
			k >>= 1;
		}
	}
	return ret;
}

function createString(s, x, y, sz, color) {
	var ret = [];
	var step = parseInt(sz * STR_W);
	
	for(let i = 0; i < s.length; ++i) {
		// console.log(s.length, s[i], s.charCodeAt(i));
		var tmp = createChar(s.charCodeAt(i), x + i * step, y, sz, color);
		ret.push(tmp);
	}
	return ret;
}

function createCircle(x, y, sz, color) {
	var ret = Bodies.circle(x, y, sz, sz);
	ret.render.fillStyle = color;
	ret.restitution = 1.0;
	ret.friction = 0.05;
	ret.frictionAir = 0.005;
	return ret;
}

function computeBbox(s, sz) {
	n = s.length;
	x = n * sz * STR_W;
	y = 6 * sz * CHAR_W;
	return [x, y];
}
